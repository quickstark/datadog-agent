# =============================================================================
# MINIMAL SYNOLOGY DATADOG AGENT CONFIGURATION
# =============================================================================
# Ultra-minimal configuration for testing and troubleshooting Synology 
# container startup issues. This configuration disables ALL advanced features
# and provides only basic Docker container monitoring.
#
# Use this configuration to:
# 1. Test if the container can start without lock-up
# 2. Verify basic Datadog Agent functionality
# 3. Troubleshoot configuration issues
# 4. Establish a working baseline before adding features
#
# Once this minimal config works, gradually re-enable features to identify
# the specific cause of any issues.
# =============================================================================

# Basic Datadog connection
dd_url: https://app.datadoghq.com
api_key: ${DD_API_KEY}

# Hostname and tags
hostname: Synology-Minimal-Test
tags:
  - env:test
  - mode:minimal
  - purpose:troubleshooting

# Logging configuration (minimal)
log_level: info
log_to_console: true  # Easier debugging
logs_enabled: false   # Disable log collection to reduce load

# CRITICAL: Disable ALL problematic features
system_probe_config:
  enabled: false  # ❌ NEVER enable on Synology (causes eBPF issues)

runtime_security_config:
  enabled: false  # ❌ NEVER enable on Synology (causes namespace corruption)

compliance_config:
  enabled: false  # ❌ NEVER enable on Synology (requires privileged access)

network_config:
  enabled: false  # ❌ NEVER enable on Synology (causes network issues)

# Disable APM to reduce resource usage
apm_config:
  enabled: false

# Disable process monitoring (can be enabled later if needed)
process_config:
  process_collection:
    enabled: false
  container_collection:
    enabled: false  # Start with container monitoring disabled
  network:
    enabled: false  # Always disabled for Synology

# Minimal Docker monitoring (safest option)
listeners:
  - name: docker

# Container monitoring (minimal)
container_collect_all: false      # Don't auto-collect all containers
container_image_enabled: false    # Disable image collection
container_lifecycle_events: false # Disable lifecycle events

# Disable metadata collection to reduce load
enable_metadata_collection: false

# Disable additional features
inventories_configuration_enabled: false
collect_ec2_tags: false
collect_gce_tags: false

# Minimal check configuration
check_runners: 1  # Reduce to single runner

# Disable remote configuration to avoid complexity
remote_configuration:
  enabled: false

# Basic forwarder settings
forwarder_timeout: 10
forwarder_retry_queue_max_size: 5

# Disable DogStatsD non-local traffic
dogstatsd_non_local_traffic: false

# Disable netflow monitoring
network_devices:
  netflow:
    enabled: false

# Simple container exclusion (exclude self)
container_exclude:
  - name:dd-agent
  - name:dd-agent-minimal
  - name:dd-agent-synology

# =============================================================================
# TESTING INSTRUCTIONS
# =============================================================================
# 1. Deploy this configuration first:
#    docker run -d --name dd-agent-minimal-test \
#      -e DD_API_KEY=your_key \
#      -v /var/run/docker.sock:/var/run/docker.sock:ro \
#      -v $(pwd)/datadog-minimal.yaml:/etc/datadog-agent/datadog.yaml:ro \
#      datadog/agent:latest
#
# 2. Verify the container starts and stays running:
#    docker ps | grep dd-agent-minimal-test
#
# 3. Check container health:
#    docker exec dd-agent-minimal-test datadog-agent health
#
# 4. If successful, gradually enable features:
#    a. container_collect_all: true
#    b. process_config.container_collection.enabled: true
#    c. logs_enabled: true
#    d. apm_config.enabled: true
#
# 5. NEVER enable these on Synology:
#    - system_probe_config.enabled
#    - runtime_security_config.enabled  
#    - compliance_config.enabled
#    - network_config.enabled
# =============================================================================